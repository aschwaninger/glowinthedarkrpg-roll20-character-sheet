<link href="https://fonts.googleapis.com/css?family=Montserrat+Alternates|Quicksand" rel="stylesheet">
<input type="radio" name="attr_sheet" value="character" checked /><label>Character</label>
<div class="sheet-tab sheet-character">
	<div class="sheet-header">
		<h1 class="sheet-logo">Glow in the Dark</h1>
		<h1 class="sheet-playbook"><input type="text" name="attr_playbook" placeholder="Playbook" /></h1>
		<h2><span name="attr_subtitle1"></span><span name="attr_subtitle2"></span></h2>
	</div>
	<div class="sheet-columns">
	    <div class="sheet-column-left">
	        <!-- Bio -->
    		<div class="sheet-bio">
    			<p>
    				<input type="text" name="attr_name" value="" />
    				<b>Name</b>
    			</p>
    			<p>
    				<input type="text" name="attr_look" value="" />
    				<b>Look</b>
    			</p>
    			<div> <!-- for some reason <p> tags close after the first div on chrome at least -->
    				<input type="text" name="attr_bg" value="" />
    				<b>Background:</b>
    				<input type="radio" name="attr_playbook_bg" value="driver" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="1" /><span>On the Run</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="2" /><span>Vengeance</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="3" /><span>Death Wish</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="4" /><span>Former Glory</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="5" /><span>Scavver</span></label>
    				</div>
    				<input type="radio" name="attr_playbook_bg" value="feral" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="6" /><span>Sole Survivor</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="7" /><span>Chosen One</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="8" /><span>Lost Tribe</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="9" /><span>Raised by Beasts</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="10" /><span>Hermit</span></label>
    				</div>
    				<input type="radio" name="attr_playbook_bg" value="junker" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="11" /><span>Machine Cult</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="12" /><span>Glow Diver</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="13" /><span>On the Run</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="14" /><span>Catastrophe</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="15" /><span>Educated</span></label>
    				</div>
    				<input type="radio" name="attr_playbook_bg" value="leftover" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="16" /><span>Fallout Shelter</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="17" /><span>Space Pod</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="18" /><span>Cryo</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="19" /><span>Lost City</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="20" /><span>Amnesia</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="21" /><span>Web of Lies</span></label>
    				</div>
    				<input type="radio" name="attr_playbook_bg" value="mutant" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="22" /><span>Exile</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="23" /><span>Clan War</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="24" /><span>Escaped</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="25" /><span>Commune</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="26" /><span>Living Legend</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="27" /><span>Glow Diver</span></label>
    				</div>
    				<input type="radio" name="attr_playbook_bg" value="reaper" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="28" /><span>Trained From Birth</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="29" /><span>Merc</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="30" /><span>Betrayal</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="31" /><span>Family</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="32" /><span>Vigilante</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="33" /><span>Pit Fighter</span></label>
    				</div>
    				<input type="radio" name="attr_playbook_bg" value="shark" />
    				<div class="sheet-background">
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="34" /><span>Escaped</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="35" /><span>Web of Lies</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="36" /><span>Urchins</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="37" /><span>Former Glory</span></label>
        				<label><input type="radio" name="attr_bg_options" class="sheet-selectable" value="38" /><span>Vendetta</span></label>
    				</div>
    			</div>
    			<p>
    				<input type="text" name="attr_taboo" value="" />
    				<b>Taboo:</b>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="barbarism" /><span>Barbarism</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="cannibalism" /><span>Cannibalism</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="murder" /><span>Murder</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="oathbreaking" /><span>Oathbreaking</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="slavery" /><span>Slavery</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="squandering" /><span>Squandering</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="torture" /><span>Torture</span></label>
    				<label><input type="radio" name="attr_taboo_options" class="sheet-selectable" value="witholding" /><span>Withholding Aid</span></label>
    			</p>
    			<p>
    				<input type="text" name="attr_vice" value="" />
    				<b>Vice/Purveyor:</b>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="denial" /><span>Denial</span></label>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="duty" /><span>Duty</span></label>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="faith" /><span>Faith</span></label>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="gambling" /><span>Gambling</span></label>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="luxury" /><span>Luxury</span></label>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="pleasure" /><span>Pleasure</span></label>
    				<label><input type="radio" name="attr_vice_options" class="sheet-selectable" value="stupor" /><span>Stupor</span></label>
    			</p>
    		</div>
    		<div class="sheet-stress-trauma-supplies">
    		    <div class="sheet-stress">
        		    <h3>Stress</h3>
        		    <div class="sheet-stress-dots">
        		        <input type="hidden" name="attr_stress" value="" />
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress1" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress2" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress3" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress4" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress5" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress6" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress7" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress8" value="1" /><i class="sheet-dot"></i></label>
            		    <label><input type="checkbox" class="sheet-selectable" name="attr_stress9" value="1" /><i class="sheet-dot"></i></label>
        		    </div>
        		</div>
        		<div class="sheet-trauma">
        		    <h3>Trauma</h3>
        		    <fieldset class="repeating_trauma">
                        <select name="attr_trauma">
                            <option value="cold">Cold</option>
                            <option value="obsessed">Obsessed</option>
                            <option value="reckless">Reckless</option>
                            <option value="paranoid">Paranoid</option>
                            <option value="sickened">Sickened</option>
                            <option value="soft">Soft</option>
                            <option value="unstable">Unstable</option>
                            <option value="vicious">Vicious</option>
                        </select>
        		    </fieldset>
        		</div>
        		<div class="sheet-supplies">
        		    <h3>
                        Supplies
                        <span><input type="number" name="attr_supplies" value="0" max="4" min="0" /></span>
                    </h3>
                    <p>
        				<b>Stash</b> <input type="number" name="attr_stash" value="0" min="0" />
        			</p>
        		</div>
    		</div>
    		
    		<div class="sheet-harm">
    		    <h3>Harm</h3>
    		    <div class="sheet-harm3"><b>3</b><input type="text" class="sheet-harm3" name="attr_harm3" placeholder="Level 3 Harm" /><b>Need Help</b></div>
    		    <div class="sheet-harm2"><b>2</b><input type="text" class="sheet-harm2" name="attr_harm2a" placeholder="Level 2 Harm" /><input type="text" class="sheet-harm2" name="attr_harm2b" placeholder="Level 2 Harm" /><b>-1d</b></div>
    		    <div class="sheet-harm1"><b>1</b><input type="text" class="sheet-harm1" name="attr_harm1a" placeholder="Level 1 Harm" /><input type="text" class="sheet-harm1" name="attr_harm1b" placeholder="Level 1 Harm" /><b>-Effect</b></div>
    		</div>
    		<div class="sheet-abilities">
    		    <h3>Special Abilities</h3>
    		    <fieldset class="repeating_feats">
    		        <div class="sheet-feat">
        		        <select name="attr_featname">
        		            <option value="">Choose Ability:</option>
    		                <optgroup label="Driver">
    		                    <option value="Need for Speed">Need for Speed</option>
    		                    <option value="Witness Me">Witness Me</option>
    		                    <option value="Maximum Overdrive">Maximum Overdrive</option>
    		                    <option value="Fast and Furious">Fast and Furious</option>
    		                    <option value="Tank Girl">Tank Girl</option>
    		                    <option value="Beat the Snake">Beat the Snake</option>
    		                    <option value="Eleanor">Eleanor</option>
    		                    <option value="Shiny and Chrome">Shiny and Chrome</option>
    		                </optgroup>
    		                <optgroup label="Feral">
    		                    <option value="Beastmaster">Beastmaster</option>
    		                    <option value="Ghost and the Darkness">Ghost and the Darkness</option>
    		                    <option value="Shadow">Shadow</option>
    		                    <option value="Predator">Predator</option>
    		                    <option value="Snake Eater">Snake Eater</option>
    		                    <option value="Hunter’s Quarry">Hunter’s Quarry</option>
    		                    <option value="Good Dog">Good Dog</option>
    		                    <option value="Brave New World">Brave New World</option>
    		                </optgroup>
    		                <optgroup label="Junker">
    		                    <option value="Blackfinger">Blackfinger</option>
    		                    <option value="Percussive Maintenance">Percussive Maintenance</option>
    		                    <option value="Organic Mechanic">Organic Mechanic</option>
    		                    <option value="Mechromancer">Mechromancer</option>
    		                    <option value="Boom Shakalaka">Boom Shakalaka</option>
    		                    <option value="Buried Treasure">Buried Treasure</option>
    		                    <option value="Junk of All Trades">Junk of All Trades</option>
    		                    <option value="Blood, Sweat, and Gears">Blood, Sweat, and Gears</option>
    		                </optgroup>
    		                <optgroup label="Leftover">
    		                    <option value="History Buff">History Buff</option>
    		                    <option value="Trusted User">Trusted User</option>
    		                    <option value="Wrong Guy, Wrong Place, Wrong Time">Wrong Guy, Wrong Place, Wrong Time</option>
    		                    <option value="Pearly Whites">Pearly Whites</option>
    		                    <option value="Listen Up You Primitive Screwheads">Listen Up You Primitive Screwheads</option>
    		                    <option value="Future Shock">Future Shock</option>
    		                    <option value="Line in the Sand">Line in the Sand</option>
    		                    <option value="Doomed to Repeat It">Doomed to Repeat It</option>
    		                </optgroup>
    		                <optgroup label="Mutant">
    		                    <option value="Ghoul">Ghoul</option>
    		                    <option value="Superhuman">Superhuman</option>
    		                    <option value="Scanner">Scanner</option>
    		                    <option value="Wings">Wings</option>
    		                    <option value="Conduit">Conduit</option>
    		                    <option value="Venomous">Venomous</option>
    		                    <option value="Invertebrate">Invertebrate</option>
    		                    <option value="Lone Wolf">Lone Wolf</option>
    		                </optgroup>
    		                <optgroup label="Reaper">
    		                    <option value="Last One Standing">Last One Standing</option>
    		                    <option value="Ayatollah of Rock’n’Rolla">Ayatollah of Rock’n’Rolla</option>
    		                    <option value="Blaze of Glory">Blaze of Glory</option>
    		                    <option value="Roadkill">Roadkill</option>
    		                    <option value="Brute Squad">Brute Squad</option>
    		                    <option value="Walk it Off">Walk it Off</option>
    		                    <option value="Not Today">Not Today</option>
    		                    <option value="Life is Cheap">Life is Cheap</option>
    		                </optgroup>
    		                <optgroup label="Shark">
    		                    <option value="Everybody’s Buddy">Everybody’s Buddy</option>
    		                    <option value="Trust Me">Trust Me</option>
    		                    <option value="Takes One to Know One">Takes One to Know One</option>
    		                    <option value="Hoarder">Hoarder</option>
    		                    <option value="Let’s You and Him Fight">Let’s You and Him Fight</option>
    		                    <option value="Connected">Connected</option>
    		                    <option value="Silver Tongue">Silver Tongue</option>
    		                    <option value="The Radscorpion and the Frog">The Radscorpion and the Frog</option>
    		                </optgroup>
    		            </select>
        		        <span class="sheet-featdesc" name="attr_featdesc"></span>
                    </div>
    		    </fieldset>
    		</div>
    		<input type="radio" name="attr_extras" value="driver" />
    		<div class="sheet-extra sheet-customride">
    		    <h3>Custom Ride</h3>
    		    <div>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_customride_harm1" value="1" /><span class="sheet-dot"></span>Weak</label>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_customride_harm2" value="1" /><span class="sheet-dot"></span>Smoking</label>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_customride_harm3" value="1" /><span class="sheet-dot"></span>Wrecked</label>
    		    </div>
    		    <div>
    		        <label><input type="checkbox" class="sheet-selectable" name="attr_customride_armor" value="1" /><span class="sheet-dot"></span>Armor</label>
    		    </div>
    		    A souped-up car, bike, light truck, SUV, buggy, or similar.
    		    <div class="sheet-edgeflaws">
        		    <b>Edges (pick one or two)</b>
    				<label><input type="checkbox" name="attr_customride_armored" class="sheet-selectable" value="1" /><span>armored</span></label>
    				<label><input type="checkbox" name="attr_customride_armed" class="sheet-selectable" value="1" /><span>armed</span></label>
    				<label><input type="checkbox" name="attr_customride_fast" class="sheet-selectable" value="1" /><span>fast</span></label>
    				<label><input type="checkbox" name="attr_customride_nimble" class="sheet-selectable" value="1" /><span>nimble</span></label>
    				<label><input type="checkbox" name="attr_customride_simple" class="sheet-selectable" value="1" /><span>simple</span></label>
    				<label><input type="checkbox" name="attr_customride_sturdy" class="sheet-selectable" value="1" /><span>sturdy</span></label>
				</div>
				<div class="sheet-edgeflaws">
        		    <b>Flaws (equal to edges)</b>
    				<label><input type="checkbox" name="attr_customride_cramped" class="sheet-selectable" value="1" /><span>cramped</span></label>
    				<label><input type="checkbox" name="attr_customride_finicky" class="sheet-selectable" value="1" /><span>finicky</span></label>
    				<label><input type="checkbox" name="attr_customride_fragile" class="sheet-selectable" value="1" /><span>fragile</span></label>
    				<label><input type="checkbox" name="attr_customride_specialized" class="sheet-selectable" value="1" /><span>specialized</span></label>
    				<label><input type="checkbox" name="attr_customride_thirsty" class="sheet-selectable" value="1" /><span>thirsty</span></label>
				</div>
				<div class="sheet-edgeflaws">
        		    <b>How Did You Get It?</b>
    				<label><input type="checkbox" name="attr_customride_salvaged" class="sheet-selectable" value="1" /><span>salvaged</span></label>
    				<label><input type="checkbox" name="attr_customride_loaned" class="sheet-selectable" value="1" /><span>loaned</span></label>
    				<label><input type="checkbox" name="attr_customride_stolen" class="sheet-selectable" value="1" /><span>stolen</span></label>
				</div>
    		</div>
    		<input type="radio" name="attr_extras" value="junker" />
    		<div class="sheet-extra sheet-jalopy">
    		    <h3>Jalopy</h3>
    		    <div>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_jalopy_harm1" value="1" /><span class="sheet-dot"></span>Weak</label>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_jalopy_harm2" value="1" /><span class="sheet-dot"></span>Smoking</label>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_jalopy_harm3" value="1" /><span class="sheet-dot"></span>Wrecked</label>
    		    </div>
    		    <div>
    		        <label><input type="checkbox" class="sheet-selectable" name="attr_jalopy_armor" value="1" /><span class="sheet-dot"></span>Armor</label>
    		    </div>
    		</div>
    		<input type="radio" name="attr_extras" value="leftover" />
    		<div class="sheet-extra sheet-bodytank">
    		    <h3>Bodytank</h3>
    		    <div>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_bodytank_harm1" value="1" /><span class="sheet-dot"></span>Damaged</label>
        		    <label><input type="checkbox" class="sheet-selectable" name="attr_bodytank_harm2" value="1" /><span class="sheet-dot"></span>Breached</label>
    		    </div>
    		    <div>
    		        <label><input type="checkbox" class="sheet-selectable" name="attr_bodytank_armor" value="1" /><span class="sheet-dot"></span>Armor</label>
    		    </div>
    		    A suit of bulky powered armor.
    		    <div class="sheet-edgeflaws">
        		    <b>Edges (pick one or two)</b>
    				<label><input type="checkbox" name="attr_bodytank_armed" class="sheet-selectable" value="1" /><span>armed</span></label>
    				<label><input type="checkbox" name="attr_bodytank_fast" class="sheet-selectable" value="1" /><span>fast</span></label>
    				<label><input type="checkbox" name="attr_bodytank_plated" class="sheet-selectable" value="1" /><span>plated</span></label>
    				<label><input type="checkbox" name="attr_bodytank_strong" class="sheet-selectable" value="1" /><span>strong</span></label>
				</div>
				<div class="sheet-edgeflaws">
        		    <b>Flaws (equal to edges)</b>
    				<label><input type="checkbox" name="attr_bodytank_limited" class="sheet-selectable" value="1" /><span>limited power</span></label>
    				<label><input type="checkbox" name="attr_bodytank_weak" class="sheet-selectable" value="1" /><span>obvious weak spot</span></label>
    				<label><input type="checkbox" name="attr_bodytank_leaky" class="sheet-selectable" value="1" /><span>leaky core</span></label>
				</div>
				<div class="sheet-edgeflaws">
        		    <b>How Did You Get It?</b>
    				<label><input type="checkbox" name="attr_bodytank_salvaged" class="sheet-selectable" value="1" /><span>salvaged</span></label>
    				<label><input type="checkbox" name="attr_bodytank_loaned" class="sheet-selectable" value="1" /><span>loaned</span></label>
    				<label><input type="checkbox" name="attr_bodytank_stolen" class="sheet-selectable" value="1" /><span>stolen</span></label>
				</div>
    		</div>
    		<input type="radio" name="attr_extras" value="mutant" />
    		<div class="sheet-extra sheet-genotype">
    		    <h3>Genotype</h3>
    		    How are you twisted by the Glow?
    		    <div class="sheet-edgeflaws">
        		    <b>Humanoid</b>
    				<label><input type="radio" name="attr_genotype" class="sheet-selectable" value="humanoid" /><span>can pass for human with effort</span></label>
				</div>
				<div class="sheet-edgeflaws">
        		    <b>Animal</b>
    				<label><input type="radio" name="attr_genotype" class="sheet-selectable" value="animal" /><span>heightened senses</span></label>
				</div>
				<div class="sheet-edgeflaws">
        		    <b>Plant</b>
    				<label><input type="radio" name="attr_genotype" class="sheet-selectable" value="plant" /><span>self-sufficient given sunlight and water</span></label>
				</div>
    		</div>
    		<div class="sheet-clocks">
    		    <h3>Clocks</h3>
    		    <fieldset class="repeating_clocks">
    		        <div class="sheet-clock">
    		            <input type="text" name="attr_clock_name" placeholder="Clock Name" />
    		            <input type="number" name="attr_clock_filled" value="0" max="12" min="0" /> out of
    		            <select name="attr_clock_ticks">
    		                <option value="4">4</option>
    		                <option value="6">6</option>
    		                <option value="8">8</option>
    		                <option value="12">12</option>
    		            </select>
    		        </div>
    		    </fieldset>
    		</div>
	    </div> <!-- / left column -->
		
		<div class="sheet-xptriggers">
		    <h3>Playbook Advancement<span>XP <input type="number" name="attr_playbook_xp" value="0" max="8" min="0" /></span></h3>
		    <div><span>Every time you roll a desperate action, mark XP in that action’s attribute.</span></div>
            <div><span name="attr_xptrigger">You addressed a challenge with vehicular skill or knowledge.</span></div>
            <div><span>You expressed your beliefs or background.</span></div>
            <div><span>Your traumas, vice, or taboo caused a problem.</span></div>
		</div>
		<!-- Load/friends -->
		<div class="sheet-load">
			<h3>Load: <span name="attr_loadtotal">0</span> <span name="attr_loadtitle">light</span></h3>
			<fieldset class="repeating_playbookitems">
			    <input type="hidden" name="attr_ploaddots" value="3" />
			    <div class="sheet-playbookitem">
    			    <label><input type="checkbox" class="sheet-selectable" name="attr_pload1" value="1" /><span class="sheet-dot"></span></label>
    			    <label><input type="checkbox" class="sheet-selectable" name="attr_pload2" value="1" /><span class="sheet-dot"></span></label>
    			    <label><input type="checkbox" class="sheet-selectable" name="attr_pload3" value="1" /><span class="sheet-dot"></span></label>
    			    <label><input type="checkbox" class="sheet-selectable" name="attr_pload0" value="1" /><span class="sheet-dot"></span></label>
    			    <input type="text" name="attr_ploadname" value="" class="sheet-load-name" placeholder="Item name" />
    			</div>
			    <input type="hidden" name="attr_pload" value="0" />
			</fieldset>
			<h3>Friends</h3>
			<fieldset class="repeating_friends">
				<div class="sheet-friend">
					<label><input type="radio" class="sheet-selectable" name="attr_friend" value="friend" /><i class="sheet-arrow-up"></i></label>
					<label><input type="radio" class="sheet-selectable" name="attr_friend" value="rival" /><i class="sheet-arrow-down"></i></label>
					<label><input type="radio" class="sheet-selectable" name="attr_friend" value="neutral" checked /><i class="sheet-shrug"></i></label>
					<input type="text" name="attr_friend_name" placeholder="Foo, a Bar" />
				</div>
			</fieldset>
		</div>
		<!-- actions -->
		<div class="sheet-actions">
		    <h3>
                Insight
                <input type="hidden" disabled="true" name="attr_insight" value="@{hack1}+@{hunt1}+@{read1}+@{scrounge1}" />
                <span>XP <input type="number" name="attr_insight_xp" value="0" max="6" min="0" /></span>
            </h3>
			<ul>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hack1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hack2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hack3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hack4" value="1" /><span class="sheet-dot"></span></label>
					<b>Hack</b>
					<!--
					<button type="roll" name="roll_action_hack" value="/roll @{bonusdice} {{bonusdice=?{Number of Dice|1}}}d6kh1 in a ?{Position|controlled|risky|desperate} position with ?{Effect|standard|great|limited|extreme|zero} effect.">Hack</button>
					-->
					<input type="hidden" name="attr_hack" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hunt1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hunt2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hunt3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_hunt4" value="1" /><span class="sheet-dot"></span></label>
					<b>Hunt</b>
					<input type="hidden" name="attr_hunt" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_read1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_read2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_read3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_read4" value="1" /><span class="sheet-dot"></span></label>
					<b>Read</b>
					<input type="hidden" name="attr_read" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_scrounge1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_scrounge2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_scrounge3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_scrounge4" value="1" /><span class="sheet-dot"></span></label>
					<b>Scrounge</b>
					<input type="hidden" name="attr_scrounge" value="0" />
				</li>
			</ul>
			<h3>
                Prowess
                <input type="hidden" disabled="true" name="attr_prowess" value="@{finesse1}+@{prowl1}+@{raid1}+@{wreck1}" />
                <span>XP <input type="number" name="attr_prowess_xp" value="0" max="6" min="0" /></span>
            </h3>
			<ul>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_finesse1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_finesse2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_finesse3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_finesse4" value="1" /><span class="sheet-dot"></span></label>
					<b>Finesse</b>
					<input type="hidden" name="attr_finesse" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_prowl1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_prowl2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_prowl3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_prowl4" value="1" /><span class="sheet-dot"></span></label>
					<b>Prowl</b>
					<input type="hidden" name="attr_prowl" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_raid1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_raid2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_raid3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_raid4" value="1" /><span class="sheet-dot"></span></label>
					<b>Raid</b>
					<input type="hidden" name="attr_raid" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_wreck1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_wreck2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_wreck3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_wreck4" value="1" /><span class="sheet-dot"></span></label>
					<b>Wreck</b>
					<input type="hidden" name="attr_wreck" value="0" />
				</li>
			</ul>
			<h3>
                Resolve
                <input type="hidden" disabled="true" name="attr_resolve" value="@{barter1}+@{boss1}+@{sway1}+@{trek1}" />
                <span>XP <input type="number" name="attr_resolve_xp" value="0" max="6" min="0" /></span>
            </h3>
			<ul>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_barter1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_barter2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_barter3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_barter4" value="1" /><span class="sheet-dot"></span></label>
					<b>Barter</b>
					<input type="hidden" name="attr_barter" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_boss1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_boss2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_boss3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_boss4" value="1" /><span class="sheet-dot"></span></label>
					<b>Boss</b>
					<input type="hidden" name="attr_boss" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_sway1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_sway2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_sway3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_sway4" value="1" /><span class="sheet-dot"></span></label>
					<b>Sway</b>
					<input type="hidden" name="attr_sway" value="0" />
				</li>
				<li>
					<label><input type="checkbox" class="sheet-selectable" name="attr_trek1" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_trek2" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_trek3" value="1" /><span class="sheet-dot"></span></label>
					<label><input type="checkbox" class="sheet-selectable" name="attr_trek4" value="1" /><span class="sheet-dot"></span></label>
					<b>Trek</b>
					<input type="hidden" name="attr_trek" value="0" />
				</li>
			</ul>
			<h3>Bonus Die +1d</h3>
			<b>Push Yourself:</b> Pay 2 stress OR Accept a <b>Devil’s Bargain</b>
			<h3>Teamwork</h3>
			<p><b>Assist</b> another character. Pay 1 stress, give bonus die.</p>
			<p>Lead a <b>group action</b>. Use best result, leader takes stress for fails.</p>
			<p><b>Protect</b> a teammate. You make the resistance roll.</p>
			<p><b>Set up</b> another character. Take action, adjust position/effect.</p>
			<h3>Planning</h3>
			<p>Choose a <b>plan</b>. Provide the <b>detail</b>.</p>
            <p><b>Assault:</b> Point of attack.</p>
            <p><b>Deception:</b> Method.</p>
            <p><b>Stealth:</b> Entry point.</p>
            <p><b>Social:</b> Social connection.</p>
            <p><b>Transport:</b> Locations/route.</p>
            <h3>Gather Information</h3>
            <p>What do they intend to do? - How can I get them to X? - What are they really feeling? - What should I be worried about? - Where’s the weakness here? - How can I find X? - What’s really going on here? - Ask about a detail for a plan.</p>
		</div>
		
		<div class="sheet-notes">
		    <h3>Notes</h3>
		    <textarea name="attr_notes"></textarea>
		</div>
	</div> <!-- / columns -->
</div>

<input type="radio" name="attr_sheet" value="tribe" /><label>Tribe</label>
<div class="sheet-tab sheet-tribe">
	<h1>Glow in the Dark</h1>
</div>

<input type="radio" name="attr_sheet" value="factions" /><label>Factions</label>
<div class="sheet-tab sheet-factions">
	<h1>Glow in the Dark</h1>
</div>

<script type="text/worker">
// naming schema for actions/stress/etc input fields with field name attr_foobar:
// attr_foobar1 attr_foobar2 ... attr_foobarN
// one input hidden name=attr_foobar to hold the summed values from foobar1 through N
// add item to allTotals array: 'foobar':N and init() will figure out the event listeners

var eventParams = [
    {'name': 'hack', dots: 4},
    {'name': 'hunt', dots: 4},
    {'name': 'read', dots: 4},
    {'name': 'scrounge', dots: 4},
    {'name': 'finesse', dots: 4},
    {'name': 'prowl', dots: 4},
    {'name': 'raid', dots: 4},
    {'name': 'wreck', dots: 4},
    {'name': 'barter', dots: 4},
    {'name': 'boss', dots: 4},
    {'name': 'sway', dots: 4},
    {'name': 'trek', dots: 4},
    {'name': 'stress', dots: 9}
];

var playbookItems = {
    'driver':{
        'subtitle1':'Nerves of steel',
        'subtitle2':'Master of the wheel',
        'xptrigger':'You addressed a challenge with vehicular skill or knowledge.',
        'items':[
            {'ploadname':'Fine anti-vehicle weapon', 'ploaddots':2},
            {'ploadname':'Fine custom ride', 'ploaddots':0},
            {'ploadname':'Speed chems', 'ploaddots':0},
            {'ploadname':'Night goggles', 'ploaddots':1},
            {'ploadname':'Ammo for AV weapon', 'ploaddots':2},
            {'ploadname':'Bottle of nitro', 'ploaddots':1},
        ]
    },
    'feral':{
        'subtitle1':'The tools of old broke the world',
        'subtitle2':'All you need to survive is you',
        'xptrigger':'You addressed a challenge with stealth or survival skills.',
        'items':[
            {'ploadname':'Fine exotic weapon', 'ploaddots':1},
            {'ploadname':'Fine animal companion', 'ploaddots':0},
            {'ploadname':'Booby traps', 'ploaddots':2},
            {'ploadname':'Smoke bomb', 'ploaddots':1},
            {'ploadname':'Survival kit', 'ploaddots':2},
            {'ploadname':'Ghillie suit/camouflage', 'ploaddots':1},
        ]
    },
    'junker':{
        'subtitle1':'This one goes here',
        'subtitle2':'That one goes there',
        'xptrigger':'You addressed a challenge with technical expertise or mayhem.',
        'items':[
            {'ploadname':'Fine electronics kit', 'ploaddots':1},
            {'ploadname':'Fine machinist\'s tools', 'ploaddots':1},
            {'ploadname':'Keycards', 'ploaddots':0},
            {'ploadname':'Jalopy', 'ploaddots':0},
            {'ploadname':'Gadgets', 'ploaddots':3},
            {'ploadname':'Vial of botdust', 'ploaddots':0},
        ]
    },
    'leftover':{
        'subtitle1':'Only you can see how far',
        'subtitle2':'the world has fallen',
        'xptrigger':'You addressed a challenge with pre-war knowledge or tech.',
        'items':[
            {'ploadname':'Fine energy weapon', 'ploaddots':1},
            {'ploadname':'Fine hand terminal', 'ploaddots':0},
            {'ploadname':'Medical kit', 'ploaddots':1},
            {'ploadname':'Motion tracker', 'ploaddots':1},
            {'ploadname':'Rad suit', 'ploaddots':1},
            {'ploadname':'Bodytank', 'ploaddots':3},
        ]
    },
    'mutant':{
        'subtitle1':'Humanity had its chance',
        'subtitle2':'You are part of the new world',
        'xptrigger':'You addressed a challenge with mutated strangeness or superiority.',
        'items':[
            {'ploadname':'Fine natural weapons', 'ploaddots':0},
            {'ploadname':'Fine boneyard maps', 'ploaddots':1},
            {'ploadname':'Fine concealing clothes', 'ploaddots':0},
            {'ploadname':'Irradiated energy shots', 'ploaddots':2},
            {'ploadname':'EMP grenade', 'ploaddots':1},
            {'ploadname':'Dose of anti-rads', 'ploaddots':0},
        ]
    },
    'reaper':{
        'subtitle1':'The strong survive',
        'subtitle2':'You plan on surviving',
        'xptrigger':'You addressed a challenge with violence or threats.',
        'items':[
            {'ploadname':'Fine hand weapon', 'ploaddots':1},
            {'ploadname':'Fine heavy weapon', 'ploaddots':2},
            {'ploadname':'Combat drugs', 'ploaddots':0},
            {'ploadname':'Armor-piercing ammo', 'ploaddots':1},
            {'ploadname':'Concealable vest', 'ploaddots':1},
            {'ploadname':'Explosive charge', 'ploaddots':1},
        ]
    },
    'shark':{
        'subtitle1':'You never break deals',
        'subtitle2':'You just bend them',
        'xptrigger':'You addressed a challenge with deception or negotiation.',
        'items':[
            {'ploadname':'Fine pre-war booze', 'ploaddots':1},
            {'ploadname':'Fine lockpicks', 'ploaddots':0},
            {'ploadname':'Party drugs', 'ploaddots':0},
            {'ploadname':'Concealable derringer', 'ploaddots':0},
            {'ploadname':'Pepper spray', 'ploaddots':0},
            {'ploadname':'Impressive but useless trinkets', 'ploaddots':1},
        ]
    },
    'default':{
        'items':[
            {'ploadname':'Primitive hand weapon', 'ploaddots':0},
            {'ploadname':'+Big', 'ploaddots':1},
            {'ploadname':'+More', 'ploaddots':2},
            {'ploadname':'Ballistic weapon', 'ploaddots':1},
            {'ploadname':'+Big', 'ploaddots':1},
            {'ploadname':'+More', 'ploaddots':2},
            {'ploadname':'Exotic weapon', 'ploaddots':1},
            {'ploadname':'Ammo', 'ploaddots':2},
            {'ploadname':'Molotov', 'ploaddots':1},
            {'ploadname':'Frag', 'ploaddots':1},
            {'ploadname':'Armor', 'ploaddots':1},
            {'ploadname':'+Heavy', 'ploaddots':2},
            {'ploadname':'Toolkit', 'ploaddots':1},
            {'ploadname':'Radio', 'ploaddots':1},
            {'ploadname':'Climbing gear', 'ploaddots':2},
            {'ploadname':'Camping gear', 'ploaddots':2}
        ]
    }
};

var perks = {
    'Need for Speed':'When you face a challenge using speed and precise driving, you gain +1 effect.',
    'Witness Me':'When you sacrifice your custom ride in order to accomplish something, say why you’re willing to do that. Pay any additional costs set by the GM and describe how you succeed.',
    'Maximum Overdrive':'You get +1d when ramming smaller vehicles. If you’re running over pedestrians, your attacks also gain +1 scale.',
    'Fast and Furious':'You can make your vehicle do things it shouldn’t be able to do. When you make a desperate roll behind the wheel, you get +1d.',
    'Tank Girl':'You may expend your special armor to resist collisions and crashes, plus anyone in a vehicle you’re driving (including you) gains +1d to resistance rolls against collision damage.',
    'Beat the Snake':'When there’s a question about who acts first, the answer is you (two characters with this ability act simultaneously).',
    'Eleanor':'When you name your custom ride, you may choose an additional edge or mitigate one flaw. You may take this a second time to gain both benefits.',
    'Shiny and Chrome':'You gain an additional xp trigger: You valued a vehicle more than your comrades.',
    'Beastmaster':'Animals and wasteland creatures will not willingly harm you unless attacked. You can interact with these creatures in exchange for small favors, such as extending their tolerance to a small group or leading the way to a location.',
    'Ghost and the Darkness':'You can push yourself to vanish in plain sight.',
    'Shadow':'You may expend your special armor to resist consequences from detection or security or to push yourself for feats of athleticism or stealth.',
    'Predator':'When you attack from hiding or spring a trap, you get +1d.',
    'Snake Eater':'You get +1d to resistance rolls vs. poisons, drugs, and tainted food. Your tribe’s upkeep cost is reduced by 1.',
    'Hunter’s Quarry':'When you hunt a target you’ve previously tracked or wounded, you gain +1 effect level.',
    'Good Dog':'Your animal companion is a mutant, cyborg, or similarly unique example of its type. You do not take stress if you lead it in a team action. Additionally, choose a trait for your animal: fast as a car - ranged attack - psychic link - massive size. Take this ability again to choose a second trait.',
    'Brave New World':'You gain an additional xp trigger: You made things harder by rejecting the World That Was. If this caused trouble for your tribe as a whole, also mark tribe xp.',
    'Blackfinger':'You get an additional downtime activity to work on long-term projects involving technology or to acquire technological assets. You get +1d to this bonus activity.',
    'Percussive Maintenance':'Two times per run, when you thump something that’s not working, it starts working.',
    'Organic Mechanic':'You know proper surgical techniques and may provide medical treatment. When you spend a downtime action providing care, your patients get a free recovery action each downtime until healed.',
    'Mechromancer':'When you invent or craft vehicles, robots, or drones, take +1 result level to your roll. You begin with one special design already known.',
    'Boom Shakalaka':'Sometimes it’s easier to destroy than create. You may expend your special armor to resist consequences from explosions or engineering mishaps, or to push yourself for sabotage or mayhem.',
    'Buried Treasure':'You know where to look for the good stuff. When you scrounge for assets, you get +1 effect.',
    'Junk of All Trades':'Take 2 stress to roll your best action rating while performing a different action. Say how you adapt your skill to this use.',
    'Blood, Sweat, and Gears':'You gain an additional xp trigger: You made progress on a new invention. If your project caused trouble for your tribe, also mark tribe xp.',
    'History Buff':'When you bring your pre-war knowledge to bear when you read a situation, you get +1d. Rolls made to gather info about locations, people, or items from the World That Was have +1 effect.',
    'Trusted User':'You know the Words of Passing and the Maidens’ Names. Pre-war security systems, robots, and AI do not consider you hostile unless you attack first. You get +1d to interact with these systems.',
    'Wrong Guy, Wrong Place, Wrong Time':'You may expend your special armor to resist consequences from a desperate roll, or to push yourself in a desperate situation.',
    'Pearly Whites':'You’ve got all your teeth! Gain +1d in situations where your appearance would be an advantage.',
    'Listen Up You Primitive Screwheads':'When you lead a cohort in combat, they’re not taken out by level 3 harm. They gain +1 effect and 1 armor.',
    'Future Shock':'Power armor is like a second skin to you. When you wear a bodytank, choose an additional edge or mitigate one flaw. You may take this a second time to gain both benefits.',
    'Line in the Sand':'You gain an additional xp trigger: You suffered for doing the right thing. If your tribe also suffered for your quaint adherence to ancient morals, also mark tribe xp.',
    'Doomed to Repeat It':'You gain an additional xp trigger: You worked toward making the wasteland more like Before. If your tribe helped you in your quest to rebuild society, also mark tribe xp.',
    'Ghoul':'You are wizened, leathery, and tough. You may expend your special armor to resist physical harm. You are immune to radiation.',
    'Superhuman':'You are freakishly-muscled and massive. You may push yourself to perform a feat of superhuman strength or speed. This factors into effect.',
    'Scanner':'Your bloated brain swells with strange power. You may telepathically communicate with anyone you can see, and can push yourself to: locate all minds around you - move an object remotely - briefly control a person or animal - read a person’s thoughts',
    'Wings':'You can fly as fast as a vehicle when you carry a light load, and as fast as a running person under a medium load. You can push yourself to carry another person or to fly under a heavy load.',
    'Conduit':'You are bioluminescent and crackle with energy. You can push yourself to release the energy in a burst around you or as a directed beam or jet.',
    'Venomous':'You are patterned and colorful. Choose a drug or poison to which you are immune. Push yourself to secrete it through your skin or exhale it as a vapor.',
    'Invertebrate':'You are rubbery, slick, or squamous, able to contort through tiny spaces. You can perform feats of inhuman flexibility. If it’s a feat of plain old human flexibility, you get +1 effect level.',
    'Lone Wolf':'You gain an additional xp trigger: You made things harder by acting alone. If your tribe ostracized you for your uncanny nature, also mark tribe xp.',
    'Last One Standing':'When you’re outnumbered in close combat, you may push yourself to do one of the following: adjust your positioning - increase your scale to that of a small gang',
    'Ayatollah of Rock’n’Rolla':'When you squander ammo, your ranged attacks gain +1 scale. You may take this ability a second time; this mitigates the requirement to waste ammo.',
    'Blaze of Glory':'When you mark a trauma you may retaliate against any and all enemies within range. Say how you bring ruin to your foes before they take you down. You may mark a trauma prematurely to use this ability.',
    'Roadkill':'When you attack from a vehicle, you gain +1d. If you are using personal weapons, your attacks gain +1 effect against vehicles.',
    'Brute Squad':'When you lead a group action in a raid, you may count 6s across different rolls as a critical success.',
    'Walk it Off':'Penalties from harm are one level less severe.',
    'Not Today':'You may expend your special armor to resist harm from combat, appearing to die (fall off a vehicle, disappear in an explosion, etc.) only to reappear in a location of your choosing with a +1d to your next action.',
    'Life is Cheap':'You gain an additional xp trigger: You chose to kill when you didn’t need to. If your tribe faced trouble because of your bloodthirst, also mark tribe xp.',
    'Everybody’s Buddy':'Pay 2 stress to reveal an old friend or contact. This can be done on a run or during downtime.',
    'Trust Me':'You seem trustworthy - until you’re not. When you lie to someone you haven’t yet lied to, you get +1d.',
    'Takes One to Know One':'You can always tell when someone is lying to you.',
    'Hoarder':'What your friends don’t know can’t hurt them. At the end of each downtime phase, you earn +2 stash.',
    'Let’s You and Him Fight':'You get +1d when you participate in a group raid action or when you take a setup action that leads to violence for someone else.',
    'Connected':'During downtime, you get +1 result level when you acquire an asset or reduce friction.',
    'Silver Tongue':'You may expend your special armor to resist consequences from suspicion or persuasion, or to push yourself for deception or negotiation.',
    'The Radscorpion and the Frog':'You gain an additional xp trigger: You exploited an ally for your own benefit.'
};

on("change:playbook", function(eventInfo) {
   getAttrs(['playbook'], function(vals) {
        // TODO only run if playbook matches playbook choices
        setItems(vals.playbook.toLowerCase());
        setSubtitle(vals.playbook.toLowerCase());
        setXP(vals.playbook.toLowerCase());
        switch (vals.playbook.toLowerCase()) {
            case 'driver':
                setAttrs({'extras':'driver', 'playbook_bg':'driver'});
                break;
            case 'feral':
                setAttrs({'extras':'foobar', 'playbook_bg':'feral'});
                break;
            case 'leftover':
                setAttrs({'extras':'leftover', 'playbook_bg':'leftover'});
                break;
            case 'junker':
                setAttrs({'extras':'junker', 'playbook_bg':'junker'});
                break;
            case 'mutant':
                setAttrs({'extras':'mutant', 'playbook_bg':'mutant'});
                break;
            case 'reaper':
                setAttrs({'extras':'foobar', 'playbook_bg':'reaper'});
                break;
            case 'shark':
                setAttrs({'extras':'foobar', 'playbook_bg':'shark'});
                break;
            default:
                setAttrs({'extras':'foobar', 'playbook_bg':'foobar'});
        }
   });
});

// load calc
on("sheet:opened change:repeating_playbookitems", function(eventInfo) {
    console.log('eventInfo on playbook items change', eventInfo);
    setLoad();
    //setAttrs({'repeating_playbookitems_playbook_load':7});
});

on("change:repeating_feats:featname", function(eventInfo) {
    console.log('change event for special ability', eventInfo);
    getAttrs(['repeating_feats_featname'], function(vals) {
        console.log('featname is ', vals);
        let perk = perks[vals.repeating_feats_featname];
        console.log('perk is ' + perk);
        setAttrs({'repeating_feats_featdesc':perk});
    });
});

eventParams.forEach(function(component) {
    let changeStr = "sheet:opened";
    for(let i = 1; i <= component.dots; i++) {
        changeStr = changeStr + " change:" + component.name + i;
    }
    on(changeStr, function(eventInfo) {
        setTotal(component.name, component.dots);
    });
});

// generic function to total up field1, field2 ... fieldmax and assign to attr_field value
var setTotal = function(field, max) {
    var fields = [];
    for (var i = 1; i <= max; i++) {
        fields.push(field + i);
    }
    getAttrs(fields, function(vals) {
       console.log(field + ' vals', vals);
       var total = 0;
       for (dot in vals) {
           total = total + parseInt(vals[dot]);
       }
       var setting = {};
       setting[field] = total;
       setAttrs(setting, {}, function() {
            console.log('setting ' + field + ' to ' + total);
            getAttrs([field], function(vals) {
               console.log('field total result', vals);
            });
       });
    });
};

var getActionName = function(name) {
  console.log('getActionName', name);
  return name.slice(0, -1); // take off numeric suffix
};

var setLoad = function() {
    console.log('setLoad');
    getSectionIDs("repeating_playbookitems", function(sectionIDs) {
        // first we set load per item
        console.log('getSectionIDs', sectionIDs);
        var totalLoad = 0;
        var loadLevel = 'light';
        _.each(sectionIDs, function(sectionID, i) {
            console.log('sectionID', sectionID, i);
            getAttrs([
                'repeating_playbookitems_' + sectionID + '_pload1',
                'repeating_playbookitems_' + sectionID + '_pload2',
                'repeating_playbookitems_' + sectionID + '_pload3'
                ], function(vals) {
                var sum = Object.values(vals).reduce((a, b) => parseInt(a) + parseInt(b), 0);
                totalLoad = parseInt(totalLoad) + parseInt(sum);
                if (totalLoad > 5) {
                    loadLevel = 'heavy';
                } else if (totalLoad > 3) {
                    loadLevel = 'medium';
                }
                let myLoad = 'repeating_playbookitems_'+sectionID+'_pload';
                setAttrs({
                   [myLoad]:sum,
                   'loadtotal':totalLoad,
                   'loadtitle':loadLevel
                });
            });
        });
    });
}

var setItems = function(playbook) {
    console.log('Clearing old items');
    getSectionIDs("repeating_playbookitems", function(sectionIDs) {
        _.each(sectionIDs, function(sectionID, i) {
            removeRepeatingRow("repeating_playbookitems_" + sectionID);
        });
    });
    var data = playbookItems[playbook].items.concat(playbookItems['default'].items);
    console.log('Getting playbook data', data);
    console.log('Testing new row creation');
    var newRows = {};
    _.each(data, function(item) {
        let itemID = generateRowID();
        console.log('attempting to add ' + itemID, item);
        for (prop in item) {
            newRows['repeating_playbookitems_' + itemID + '_' + prop] = item[prop];
        }
    });
    console.log('Should be adding', newRows);
    setAttrs(newRows);
}

var setSubtitle = function(playbook) {
    let newSubtitle = {};
    newSubtitle['subtitle1'] = playbookItems[playbook].subtitle1;
    newSubtitle['subtitle2'] = playbookItems[playbook].subtitle2;
    console.log('setting subtitle to ', newSubtitle);
    setAttrs(newSubtitle);
}

var setXP = function(playbook) {
    let newTrigger = {};
    newTrigger['xptrigger'] = playbookItems[playbook].xptrigger;
    setAttrs(newTrigger);
}

</script>
